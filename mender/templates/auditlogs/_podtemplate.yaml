{{- define "mender.auditlogsPodTemplate" -}}
metadata:
  {{- with .dot.Values.auditlogs.podAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
  labels:
    {{- include "mender.labels" . | nindent 4 }}
spec:
  containers:
  - name: {{ if .migration }}
    {{- printf "%s-migration" .component -}}
    {{ else }}
    {{- print .component -}}
    {{ end }}
    {{- include "mender.container" . | nindent 4 }}
    env:
    - name: AUDITLOGS_AUDITLOG_EXPIRE_SECONDS
      value: {{ .dot.Values.auditlogs.logRetentionSeconds | int | toString | quote }}
    - name: AUDITLOGS_MONGO_URL
      {{- include "mender.mongoUrl" . | nindent 6 }}
    {{- range $k, $v := .override.env }}
    - name: {{ quote $k }}
      value: {{ quote $v }}
    {{- end }}
    {{- with coalesce .override.customEnvs .dot.Values.default.customEnvs }}
    {{- toYaml . | indent 4 }}
    {{- end }}
    {{- if and .mender .mender.extraEnv }}
    {{- toYaml .mender.extraEnv | nindent 4 }}
    {{- end }}
  {{- include "mender.podSpec" . | nindent 2 }}
{{- end }}
